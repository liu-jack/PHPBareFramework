server {
	listen       80;
	server_name  zf.bare.com;
	root  /home/camfee/www/www.bare.com;
	index index.html index.htm index.php;

	if (!-e $request_filename) {
		rewrite ^/([\w\/]+)/(v[0-9\.]+)$ /api.php/$1?_v=$2 last;
		rewrite ^(.*)$ /index.php$1 last; 
		break; 
	}

	location ~ \.php(.*)$  {
		fastcgi_pass  127.0.0.1:9000;
		fastcgi_intercept_errors on;
		fastcgi_index index.php;
		include fastcgi.conf;
	}
}

server {
	listen       80;
	server_name  bg.bare.com;
	root  /home/camfee/www/www.bare.com;
	index admin.html admin.htm admin.php;

	rewrite ^(/admin.php)?(.*)$ /admin.php$2?_b=1 last; 

	location ~ \.php(.*)$  {
		fastcgi_pass  127.0.0.1:9000;
		fastcgi_intercept_errors on;
		fastcgi_index index.php;
		include fastcgi.conf;
	}
}

server {
	listen       80;
	server_name  api.bare.com;
	root  /home/camfee/www/www.bare.com;
	index api.html api.htm api.php;

	rewrite ^/([\w\/]+)/(v[0-9\.]+)$ /api.php/$1?_v=$2 last; 

	location ~ \.php(.*)$  {
		fastcgi_pass  127.0.0.1:9000;
		fastcgi_intercept_errors on;
		fastcgi_index index.php;
		include fastcgi.conf;
	}
}
