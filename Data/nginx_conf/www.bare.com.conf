server {
	listen       80;
	server_name  zf.bare.com;
	root  /home/camfee/www/www.bare.com;
	index index.html index.htm index.php;

	if (!-e $request_filename) {
		rewrite ^/([\w\/]+)/(v[0-9\.]+)$ /api.php/$1?_v=$2 last;
        rewrite ^/Public/upload/book/cover/.+$ /Public/upload/book/cover/nocover.jpg last;
        rewrite ^/book/type_(\d+)(\.html)?$ /index.php/book/index/type/tid/$1 last;
        rewrite ^/book/(\d+)_(\d+)(\.html)?$ /index.php/book/index/column/fid/$1/bid/$2 last;
        rewrite ^/book/(\d+)_(\d+)/(\d+)(\.html)?$ /index.php/book/index/content/fid/$1/bid/$2/cid/$3 last;
        rewrite ^(.*)$ /index.php$1 last;
        break;
	}

	location ~ \.php(.*)$  {
		fastcgi_pass  127.0.0.1:9000;
		fastcgi_intercept_errors on;
		fastcgi_index index.php;
		include fastcgi.conf;
	}
}

server {
	listen       80;
	server_name  bg.bare.com;
	root  /home/camfee/www/www.bare.com;
	index admin.html admin.htm admin.php;

	if (!-e $request_filename) {
		rewrite ^(/admin.php)?(.*)$ /admin.php$2 last;
	}
	location ~ \.php(.*)$  {
		fastcgi_pass  127.0.0.1:9000;
		fastcgi_intercept_errors on;
		fastcgi_index index.php;
		include fastcgi.conf;
	}
}

server {
	listen       80;
	server_name  api.bare.com;
	root  /home/camfee/www/www.bare.com;
	index api.html api.htm api.php;

	rewrite ^/([\w\/]+)/(v[0-9\.]+)$ /api.php/$1?_v=$2 last; 

	location ~ \.php(.*)$  {
		fastcgi_pass  127.0.0.1:9000;
		fastcgi_intercept_errors on;
		fastcgi_index index.php;
		include fastcgi.conf;
	}
}
